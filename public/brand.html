<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Brand Offers</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  
  <style>
    :root {
      --blue: #3498db;
      --teal: #1abcbc;
      --white: #ffffff;
      --dark: #1e1e1e;
    }

    body {
      background: #f4f7fa;
    }

    /* ---------- GRID (4 PER ROW) ---------- */
    .coupon-grid {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 20px;
    }
    @media (min-width: 576px) { .coupon-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 992px) { .coupon-grid { grid-template-columns: repeat(4, 1fr); } }

    /* ---------- CARD ---------- */
    .coupon-card {
      background: #fff;
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.08);
      cursor: pointer;
      border-left: 6px solid var(--blue);
      transition: 0.3s;
    }
    .coupon-card:hover { transform: translateY(-4px); }

    .discount-box {
      font-size: 20px;
      font-weight: 900;
      color: var(--blue);
      background: #e8f1ff;
      padding: 8px;
      border-radius: 12px;
      text-align: center;
    }

    /* ---------- MODAL ---------- */
    .custom-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999999;
    }

    .custom-modal {
      width: 90%;
      max-width: 500px;
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
      animation: fadeIn 0.25s ease;
      position: relative;
    }

    @keyframes fadeIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .modal-close {
      position: absolute;
      right: 18px;
      top: 12px;
      font-size: 22px;
      cursor: pointer;
      color: #333;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--dark);
    }

    /* ---------- SCROLL AREA ---------- */
    .modal-desc {
      max-height: 150px;
      overflow-y: auto;
      padding-right: 5px;
      font-size: 15px;
      border-left: 3px solid var(--blue);
      padding-left: 10px;
    }

    /* Custom Scrollbar */
    .modal-desc::-webkit-scrollbar {
      width: 6px;
    }
    .modal-desc::-webkit-scrollbar-thumb {
      background: var(--blue);
      border-radius: 10px;
    }

    .modal-category {
      margin-top: 8px;
      font-size: 14px;
      color: #777;
    }

    .modal-btn {
      margin-top: 18px;
      width: 100%;
      padding: 12px;
      background: linear-gradient(45deg, var(--blue), var(--teal));
      border: none;
      border-radius: 30px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    .modal-btn:hover { transform: scale(1.04); }

    /* TOAST */
    #toastMsg {
      position: fixed;
      bottom: 22px;
      right: 20px;
      background: var(--blue);
      color: #fff;
      padding: 14px 20px;
      border-radius: 10px;
      display: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    /* Back Button */
    #backBtn {
      position: fixed;
      left: 12px;
      top: 12px;
      z-index: 999;
      background: var(--blue);
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 30px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }
    #backBtn i { margin-right: 5px; }
  </style>
</head>

<body>

<button id="backBtn" onclick="history.back()">
  <i class="fa-solid fa-arrow-left"></i> Back
</button>


<div class="container mt-5 pt-3">
  <h3 id="brandTitle" class="fw-bold mb-4"></h3>
  <div id="couponList" class="coupon-grid"></div>
</div>

<!-- ------------ MODAL ------------ -->
<div class="custom-modal-overlay" id="couponModal">
  <div class="custom-modal">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <div id="modalTitle" class="modal-title"></div>
    <div id="modalDesc" class="modal-desc"></div>
    <div id="modalCategory" class="modal-category"></div>

    <button id="modalBtn" class="modal-btn">Show Code</button>
  </div>
</div>

<div id="toastMsg"></div>

<script>
  const slug = window.location.pathname.split("/").pop();
  document.getElementById("brandTitle").innerText =
    slug.replace(/-/g, " ").toUpperCase();

  /* ------------------------ TOAST ------------------------ */
  function showCountdownToast(seconds, url) {
    const t = document.getElementById("toastMsg");
    let remaining = seconds;

    t.style.display = "block";
    t.innerText = `Code copied! Redirecting in ${remaining}s...`;

    const interval = setInterval(() => {
      remaining--;
      t.innerText = `Code copied! Redirecting in ${remaining}s...`;

      if (remaining <= 0) {
        clearInterval(interval);
        t.style.display = "none";
        window.location.href = url;

      }
    }, 1000);
  }

  /* ------------------------ MODAL FUNCTIONS ------------------------ */
  function openModal(coupon) {
    document.getElementById("modalTitle").innerText = coupon.title;
    document.getElementById("modalDesc").innerText = coupon.description || "No description";
    document.getElementById("modalCategory").innerText = coupon.category?.title || "";

    document.getElementById("modalBtn").onclick = () => {
      navigator.clipboard.writeText(coupon.code);
      closeModal();
      showCountdownToast(8, coupon.url);
    };

    document.getElementById("couponModal").style.display = "flex";
  }

  function closeModal() {
    document.getElementById("couponModal").style.display = "none";
  }

  /* ------------------------ LOAD COUPONS ------------------------ */
  async function loadCoupons() {
    let res = await fetch("/api/coupons");
    let allCoupons = await res.json();

    const box = document.getElementById("couponList");
    box.innerHTML = "";

    const list = allCoupons.filter(c => c.category?.slug === slug);

    list.forEach(c => {
      const discount = c.title.replace(/[^\d%]/g, "") || "10%";

      box.innerHTML += `
        <div class="coupon-card" onclick='openModal(${JSON.stringify(c).replace(/"/g, "&quot;")})'>
          <div class="discount-box">${discount} OFF</div>
          <h6 class="mt-2">${c.title}</h6>
          <small class="text-muted">${c.category?.title || ""}</small>
        </div>
      `;
    });
  }

  loadCoupons();
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
